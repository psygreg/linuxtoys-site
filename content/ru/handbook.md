# Руководство разработчика

## I. Руководство по внесению вклада

Спасибо за интерес к участию в разработке LinuxToys! Этот проект направлен на предоставление коллекции инструментов для Linux удобным для пользователя способом, делая мощную функциональность доступной для всех пользователей.

### Документация

Прежде чем начать, пожалуйста, ознакомьтесь с [Руководством разработчика](https://github.com/psygreg/linuxtoys/wiki/Developer-Handbook) для полной документации по библиотекам LinuxToys и практикам разработки.

#### Приоритеты разработки

При внесении вклада в LinuxToys, пожалуйста, помните об этих основных приоритетах, перечисленных в порядке важности:

#### 1. Безопасность и конфиденциальность прежде всего
- **Безопасность и конфиденциальность пользователя всегда должны быть высшим приоритетом**
- Все скрипты и инструменты должны быть тщательно протестированы и проверены
- Никогда не реализуйте функции, которые могут скомпрометировать данные пользователя или безопасность системы
- Четко документируйте любые потенциальные риски или изменения системы
- Следуйте практикам безопасного кодирования и проверяйте все пользовательские входы

#### 2. Удобство использования и доступность
- Проектируйте с учетом среднего пользователя компьютера
- Предоставляйте четкие, интуитивные интерфейсы
- Включайте полезные описания и руководство для всех функций, сохраняя лаконичность
- Обеспечивайте доступность для пользователей с разными уровнями технических навыков
- Используйте простой язык в пользовательском тексте и сообщениях об ошибках

#### 3. Надежность и самодостаточность
- **Все функции должны работать как задумано, не требуя дополнительных обходных путей от пользователя**
- Инструменты должны грациозно обрабатывать крайние случаи
- Предоставляйте четкие сообщения об ошибках, когда что-то идет не так
- Тестируйте на поддерживаемых дистрибутивах и версиях
- Убедитесь, что зависимости правильно управляются и документированы

#### 4. Ограничения инструментов CLI
- **Интерфейсы командной строки должны быть ограничены случаями использования разработчиками и системными администраторами**
- Средний пользователь компьютера не знает или не хочет иметь дело с эмуляторами терминала
- Функции только CLI должны быть ограничены меню разработчика и системного администрирования

### Наконец...

- Все Pull Request будут вручную проверены перед одобрением
- Убедитесь, что ваши вклады соответствуют приоритетам разработки, перечисленным выше
- Тестируйте свои изменения на разных дистрибутивах Linux, когда это возможно
- Следуйте существующему стилю кода и структуре
- Документируйте любые новые функции или значительные изменения

### Начало работы

1. Ознакомьтесь с [Руководством разработчика](https://github.com/psygreg/linuxtoys/wiki/Developer-Handbook)
2. Сделайте форк репозитория и создайте ветку функции
3. Внесите изменения, следуя приоритетам разработки
4. Тщательно тестируйте на поддерживаемых системах
5. Отправьте Pull Request с четким описанием ваших изменений

Мы ценим ваш вклад в то, чтобы сделать Linux более доступным и удобным для всех!

## II. Функции и использование LinuxToys

### Структура скрипта и метаданные

#### Базовый шаблон скрипта

Все скрипты LinuxToys следуют стандартизированной структуре с заголовками метаданных:

```bash
#!/bin/bash
# name: Human Readable Name (или заполнитель для перевода)
# version: 1.0
# description: description_key_or_text
# icon: icon-name
# compat: ubuntu, debian, fedora, arch, cachy, suse, ostree, ublue
# reboot: no|yes|ostree
# noconfirm: yes
# localize: en, pt...
# nocontainer

# --- Начало кода скрипта ---
. /etc/os-release
SCRIPT_DIR="$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")"
source "$SCRIPT_DIR/../../libs/linuxtoys.lib"
_lang_
source "$SCRIPT_DIR/../../libs/lang/${langfile}.lib"
source "$SCRIPT_DIR/../../libs/helpers.lib"

# Ваша логика скрипта здесь
```

#### Заголовки метаданных

**Обязательные заголовки**

- **`# name:`** - Отображаемое имя, показываемое в UI
- **`# version:`** - Версия скрипта (обычно "1.0")
- **`# description:`** - Ключ описания для переводов или прямой текст
- **`# icon:`** - Идентификатор иконки для UI - *не требуется в меню контрольных списков*

**Опциональные заголовки**

- **`# compat:`** - Список совместимых дистрибутивов через запятую
- **`# reboot:`** - Требование перезагрузки: `no` (по умолчанию), `yes` или `ostree`
- **`# noconfirm:`** - Пропустить диалог подтверждения, если установлено в `yes`
- **`# localize:`** - Список поддерживаемых локалей через запятую
- **`# nocontainer:`** - Скрыть скрипт в контейнерных средах

#### Система совместимости

LinuxToys поддерживает множественные дистрибутивы Linux через систему ключей совместимости:

**Поддерживаемые дистрибутивы**

- **`ubuntu`** - Ubuntu и производные
- **`debian`** - Debian и производные
- **`fedora`** - Fedora и системы на базе RHEL
- **`arch`** - Arch Linux (исключая CachyOS)
- **`cachy`** - CachyOS специально
- **`suse`** - openSUSE и системы SUSE
- **`ostree`** - системы на базе rpm-ostree
- **`ublue`** - образы Universal Blue (Bazzite, Bluefin, Aurora)

#### Требования перезагрузки
- **`no`** - Перезагрузка не требуется (по умолчанию)
- **`yes`** - Всегда требует перезагрузку
- **`ostree`** - Требует перезагрузку только на системах ostree/ublue

### Основные библиотеки

#### linuxtoys.lib

Главная библиотека предоставляет основные функции для операций скриптов:

**Управление пакетами**

```bash
# Объявить пакеты для установки
_packages=(package1 package2 package3)
_install_
```

Функция `_install_` автоматически:
- Определяет менеджер пакетов (apt, pacman, dnf, zypper, rpm-ostree)
- Проверяет, установлены ли пакеты уже
- Устанавливает недостающие пакеты, используя подходящий метод
- Обрабатывает системы rpm-ostree со слоистыми пакетами
- Сбрасывает переменную `_packages` при завершении, позволяя использовать её несколько раз в том же скрипте при необходимости

**Управление Flatpak**

```bash
# Объявить пакеты для установки
_flatpaks=(package1 package2 package3)
_flatpak_
```

Функция `_flatpak_` автоматически устанавливает каждый flatpak в массиве со стандартными параметрами (пользовательский уровень, репозиторий Flathub). Она также сбросит `_flatpaks` при завершении, позволяя использовать её несколько раз в том же скрипте при необходимости.

### Язык и локализация

#### Система переводов

LinuxToys поддерживает множественные языки через файлы переводов JSON:

**Структура языковых файлов**

```
p3/libs/lang/
├── en.json    # Английский (запасной)
├── pt.json    # Португальский
└── ...
```

#### Использование переводов
```bash
# Загрузить определение языка
_lang_
source "$SCRIPT_DIR/../../libs/lang/${langfile}.lib"

# Использовать переводы в диалогах zenity
zenity --question --text "$translation_key" --width 360 --height 300
```

### Лучшие практики

#### Разработка скриптов
1. **Всегда используйте заголовки метаданных** для правильной категоризации и фильтрации
2. **Тестируйте совместимость** на разных дистрибутивах, когда возможно
3. **Обрабатывайте ошибки грациозно** с подходящей обратной связью пользователю
4. **Используйте существующие библиотеки** вместо переимплементации общей функциональности
5. **Следуйте стандартной структуре скрипта** для согласованности

Это руководство обеспечивает основу для создания надежных, совместимых и удобных для пользователя скриптов в экосистеме LinuxToys. Используя предоставленные библиотеки и следуя этим соглашениям, разработчики могут создавать скрипты, которые работают беспрепятственно на множественных дистрибутивах Linux, обеспечивая согласованный пользовательский опыт.
